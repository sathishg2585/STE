(function(){function g(b,e){b=b||"";e=e||{};for(var c in f)f.hasOwnProperty(c)&&(e.autoFix&&(e["fix_"+c]=!0),e.fix=e.fix||e["fix_"+c]);var h={comment:/^\x3c!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s>]/i,startTag:/^</,chars:/^[^<]/},m={comment:function(){var a=b.indexOf("--\x3e");if(0<=a)return{content:b.substr(4,a),length:a+3}},endTag:function(){var a=b.match(r);if(a)return{tagName:a[1],length:a[0].length}},atomicTag:function(){var a=m.startTag();if(a){var d=b.slice(a.length);
if(d.match(RegExp("</\\s*"+a.tagName+"\\s*>","i"))&&(d=d.match(RegExp("([\\s\\S]*?)</\\s*"+a.tagName+"\\s*>","i"))))return{tagName:a.tagName,attrs:a.attrs,content:d[1],length:d[0].length+a.length}}},startTag:function(){var a=b.match(q);if(a){var d={};a[2].replace(u,function(a,l,c,b,h){a=c||b||h||v.test(l)&&l||null;d[l]=a});return{tagName:a[1],attrs:d,unary:!!a[3],length:a[0].length}}},chars:function(){var a=b.indexOf("<");return{length:0<=a?a:b.length}}},a=function(){for(var a in h)if(h[a].test(b)){p&&
console.log("suspected "+a);var d=m[a]();return d?(p&&console.log("parsed "+a,d),d.type=d.type||a,d.text=b.substr(0,d.length),b=b.slice(d.length),d):null}};e.fix&&function(){var c=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,d=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i,k=[];k.last=function(){return this[this.length-1]};k.lastTagNameEq=function(a){var d=this.last();return d&&d.tagName&&d.tagName.toUpperCase()===a.toUpperCase()};k.containsTagName=function(a){for(var d=
0,c;c=this[d];d++)if(c.tagName===a)return!0;return!1};var h=function(a){a&&"startTag"===a.type&&(a.unary=c.test(a.tagName)||a.unary);return a},n=a,m=function(){b="</"+k.pop().tagName+">"+b},g={startTag:function(a){var c=a.tagName;"TR"===c.toUpperCase()&&k.lastTagNameEq("TABLE")?(b="<TBODY>"+b,f()):e.fix_selfClose&&d.test(c)&&k.containsTagName(c)?k.lastTagNameEq(c)?m():(b="</"+a.tagName+">"+b,f()):a.unary||k.push(a)},endTag:function(a){k.last()?e.fix_tagSoup&&!k.lastTagNameEq(a.tagName)?m():k.pop():
e.fix_tagSoup&&(n(),f())}},f=function(){var a=b,d=h(n());b=a;if(d&&g[d.type])g[d.type](d)};a=function(){f();return h(n())}}();return{append:function(a){b+=a},readToken:a,readTokens:function(c){for(var d;(d=a())&&(!c[d.type]||!1!==c[d.type](d)););},clear:function(){var a=b;b="";return a},rest:function(){return b},stack:[]}}var f=function(){var b={},e=this.document.createElement("div");e.innerHTML="<P><I></P></I>";b.tagSoup="<P><I></P></I>"!==e.innerHTML;e.innerHTML="<P><i><P></P></i></P>";b.selfClose=
2===e.childNodes.length;return b}(),q=/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,u=/([\-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,v=/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i,p=!1;g.supports=f;g.tokenToString=function(b){var e={comment:function(c){return"<--"+c.content+"--\x3e"},endTag:function(c){return"</"+
c.tagName+">"},atomicTag:function(c){console.log(c);return e.startTag(c)+c.content+e.endTag(c)},startTag:function(c){var b="<"+c.tagName,m;for(m in c.attrs)var a=c.attrs[m],b=b+(" "+m+'="'+(a?a.replace(/(^|[^\\])"/g,'$1\\"'):"")+'"');return b+(c.unary?"/>":">")},chars:function(c){return c.text}};return e[b.type](b)};g.escapeAttributes=function(b){var e={},c;for(c in b){var h=b[c];e[c]=h&&h.replace(/(^|[^\\])"/g,'$1\\"')}return e};for(var t in f)g.browserHasFlaw=g.browserHasFlaw||!f[t]&&t;this.htmlParser=
g})();
(function(){function g(){}function f(c,b,m){var a,l=c&&c.length||0;for(a=0;a<l;a++)b.call(m,c[a],a)}function q(c,b,m){for(var a in c)c.hasOwnProperty(a)&&b.call(m,a,c[a])}function r(c,b){q(b,function(b,a){c[b]=a});return c}function u(c,b){c=c||{};q(b,function(b,a){null==c[b]&&(c[b]=a)});return c}function v(c){try{return t.call(c)}catch(b){var e=[];f(c,function(a){e.push(a)});return e}}var p=this;if(!p.postscribe){var t=Array.prototype.slice,b=function(){function c(a,b,d){var c=e+b;if(2===arguments.length)return c=a.getAttribute(c),
null==c?c:String(c);null!=d&&""!==d?a.setAttribute(c,d):a.removeAttribute(c)}function b(a,l){var d=a.ownerDocument;r(this,{root:a,options:l,win:d.defaultView||d.parentWindow,doc:d,parser:p.htmlParser("",{autoFix:!0}),actuals:[a],proxyHistory:"",proxyRoot:d.createElement(a.nodeName),scriptStack:[],writeQueue:[]});c(this.proxyRoot,"proxyof",0)}var e="data-ps-";b.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var a;!this.deferredRemote&&this.writeQueue.length;)a=this.writeQueue.shift(),
"function"===typeof a?this.callFunction(a):this.writeImpl(a)};b.prototype.callFunction=function(a){var b={type:"function",value:a.name||a.toString()};this.onScriptStart(b);a.call(this.win,this.doc);this.onScriptDone(b)};b.prototype.writeImpl=function(a){this.parser.append(a);var b;for(a=[];(b=this.parser.readToken())&&!/^script$/i.test(b.tagName);)a.push(b);this.writeStaticTokens(a);b&&this.handleScriptToken(b)};b.prototype.writeStaticTokens=function(a){a=this.buildChunk(a);if(a.actual)return a.html=
this.proxyHistory+a.actual,this.proxyHistory+=a.proxy,this.proxyRoot.innerHTML=a.html,this.walkChunk(),a};b.prototype.buildChunk=function(a){var b=this.actuals.length,d=[],c=[],g=[];f(a,function(a){d.push(a.text);if(a.attrs){if(!/^noscript$/i.test(a.tagName)){var f=b++;c.push(a.text.replace(/(\/?>)/," "+e+"id="+f+" $1"));"ps-script"!==a.attrs.id&&g.push("atomicTag"===a.type?"":"<"+a.tagName+" "+e+"proxyof="+f+(a.unary?"/>":">"))}}else c.push(a.text),g.push("endTag"===a.type?a.text:"")});return{tokens:a,
raw:d.join(""),actual:c.join(""),proxy:g.join("")}};b.prototype.walkChunk=function(){for(var a,b=[this.proxyRoot];null!=(a=b.shift());){var d=1===a.nodeType;d&&c(a,"proxyof")||(d&&(this.actuals[c(a,"id")]=a,c(a,"id",null)),(d=a.parentNode&&c(a.parentNode,"proxyof"))&&this.actuals[d].appendChild(a));b.unshift.apply(b,v(a.childNodes))}};b.prototype.handleScriptToken=function(a){var b=this.parser.clear();b&&this.writeQueue.unshift(b);a.src=a.attrs.src||a.attrs.SRC;if(a.src&&this.scriptStack.length)this.deferredRemote=
a;else this.onScriptStart(a);var d=this;this.writeScriptToken(a,function(){d.onScriptDone(a)})};b.prototype.onScriptStart=function(a){a.outerWrites=this.writeQueue;this.writeQueue=[];this.scriptStack.unshift(a)};b.prototype.onScriptDone=function(a){a!==this.scriptStack[0]?this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,a.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=
null))};b.prototype.writeScriptToken=function(a,b){var d=this.buildScript(a);a.src&&(d.src=a.src,this.scriptLoadHandler(d,b));try{this.insertScript(d),a.src||b()}catch(c){this.options.error(c),b()}};b.prototype.buildScript=function(a){var b=this.doc.createElement(a.tagName);q(a.attrs,function(a,c){b.setAttribute(a,c)});a.content&&(b.text=a.content);return b};b.prototype.insertScript=function(a){this.writeImpl('<span id="ps-script"/>');var b=this.doc.getElementById("ps-script");b.parentNode.replaceChild(a,
b)};b.prototype.scriptLoadHandler=function(a,b){function c(){a=a.onload=a.onreadystatechange=a.onerror=null;b()}var e=this.options.error;r(a,{onload:function(){c()},onreadystatechange:function(){/^(loaded|complete)$/.test(a.readyState)&&c()},onerror:function(){c();e({message:"remote script failed "+a.src})}})};return b}(),e=function(){function c(){var a=l.shift();a&&(a.stream=e.apply(null,a))}function e(k,l,n){function h(a){a=n.beforeWrite(a);d.write(a);n.afterWrite(a)}d=new b(k,n);d.id=a++;d.name=
n.name||d.id;f.streams[d.name]=d;var s=k.ownerDocument,p={write:s.write,writeln:s.writeln};r(s,{write:h,writeln:function(a){h(a+"\n")}});var q=d.win.onerror||g;d.win.onerror=function(a,b,c){n.error({msg:a+" - "+b+":"+c});q.apply(d.win,arguments)};d.write(l,function(){r(s,p);d.win.onerror=q;n.done();d=null;c()});return d}function f(a,b,e){"function"===typeof e&&(e={done:e});e=u(e,{done:g,error:function(a){throw a;},beforeWrite:function(a){return a},afterWrite:g});a=/^#/.test(a)?p.document.getElementById(a.substr(1)):
a.jquery?a[0]:a;var h=[a,b,e];a.postscribe={cancel:function(){h.stream?h.stream.abort():h[1]=g}};l.push(h);d||c();return a.postscribe}var a=0,l=[],d=null;return r(f,{streams:{},queue:l,WriteStream:b})}();p.postscribe=e}})();
